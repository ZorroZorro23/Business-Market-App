<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>AtlasGo Market Scanner</title>
  <style>
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #1a1a1a;
      color: #eee;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    #sidebar {
      width: 350px;
      background: #222;
      border-right: 1px solid #444;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 10;
      box-shadow: 2px 0 10px #000;
      min-height: 0;
    }

    h2 { color: #3b82f6; margin: 0; font-size: 22px; }
    label { font-size: 11px; color: #aaa; font-weight: bold; display: block; margin-bottom: 3px; }

    input, select, button {
      width: 100%;
      padding: 8px;
      background: #333;
      border: 1px solid #555;
      color: white;
      border-radius: 4px;
      box-sizing: border-box;
      margin-bottom: 10px;
    }

    button {
      font-weight: bold;
      cursor: pointer;
      text-transform: uppercase;
      border: none;
      transition: 0.2s;
    }

    .btn-scan { background: #3b82f6; margin-top: 5px; }
    .btn-scan:hover { background: #2563eb; }

    .btn-help {
      background: rgba(255,255,255,0.04);
      border: 1px solid #3a3a3a;
      color: #cfcfcf;
      margin-top: 6px;
      text-transform: none;
      font-weight: 800;
      padding: 8px;
      border-radius: 10px;
    }
    .btn-help:hover { background: rgba(255,255,255,0.08); }

    .btn-geo {
      background: transparent;
      border: 1px solid #27ae60;
      color: #27ae60;
      margin-bottom: 15px;
    }
    .btn-geo:hover { background: rgba(39, 174, 96, 0.1); }

    .topbar {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 6px;
    }
    .auth-btn {
      width:auto;
      padding: 6px 10px;
      font-size: 11px;
      border-radius: 6px;
      background: transparent;
      border: 1px solid #3b82f6;
      color: #3b82f6;
      margin-bottom: 0;
      text-transform: none;
      white-space: nowrap;
    }
    .auth-btn:hover { background: rgba(59,130,246,0.12); }

    .tabs {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin-top: 6px;
      margin-bottom: 6px;
    }
    .tab-btn {
      margin: 0;
      padding: 8px 6px;
      font-size: 11px;
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
      border: 1px solid #333;
      color: #ddd;
      text-transform: none;
      font-weight: 800;
    }
    .tab-btn.active {
      border-color: #3b82f6;
      background: rgba(59,130,246,0.18);
      color: #fff;
    }

    #panelArea {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      border-top: 1px solid #444;
      padding-top: 10px;
      gap: 10px;
    }

    .panel {
      display: none;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }
    .panel.active {
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    #resultsList, #historyList, #favList {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      padding-right: 2px;
    }

    .card {
      padding: 12px;
      border-bottom: 1px solid #333;
      cursor: pointer;
      position: relative;
      transition: 0.2s;
      display: flex;
      gap: 10px;
    }
    .card:hover { background: #2a2a2a; border-left: 3px solid #3b82f6; }

    .place-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; background: #444; }
    .place-info { flex: 1; padding-right: 64px; min-width: 0; }

    .best-badge { position: absolute; top: 8px; left: 8px; background: #27ae60; font-size: 9px; padding: 2px 6px; border-radius: 6px; font-weight: 900; }

    .route-info { font-size: 11px; color: #27ae60; margin-top: 5px; font-weight: bold; display: none; }
    .transit-steps {
      font-size: 10px; color: #ddd; margin-top: 4px;
      background: rgba(255,255,255,0.08); padding: 6px; border-radius: 8px;
    }
    .step-badge {
      display: inline-block;
      background: #333;
      border: 1px solid #555;
      padding: 1px 6px;
      border-radius: 7px;
      margin-right: 4px;
      margin-bottom: 4px;
    }

    .action-col {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      opacity: 0.35;
      transition: 0.2s;
    }
    .card:hover .action-col { opacity: 1; }

    @media (hover: none) {
      .action-col { opacity: 0.65; }
    }

    .action-btn {
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background: rgba(43,43,43,0.85);
      border: 1px solid #555;
      color: #fff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
      padding: 0;
      margin: 0;
      text-transform: none;
      font-weight: 900;
    }
    .action-btn:hover { background: rgba(55,55,55,0.95); }

    .action-btn.fav-btn { color: #f1c40f; }
    .action-btn.review-btn { color: #3b82f6; }
    .action-btn.del-btn { color: #ff6b6b; }

    .row-info {
      font-size: 11px;
      color: #666;
      margin-top: 5px;
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .hint {
      font-size: 11px;
      color: #777;
      padding: 10px;
      border: 1px dashed #333;
      border-radius: 10px;
      background: rgba(255,255,255,0.03);
    }

    #mapWrap {
      position: relative;
      flex: 1;
      min-width: 0;
      height: 100%;
      background: #111;
    }

    #map {
      width: 100%;
      height: 100%;
      background: #111;
    }

    #sv-panel {
      position: absolute;
      bottom: 30px;
      right: 20px;
      width: 350px;
      height: 250px;
      background: #000;
      border: 3px solid #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.7);
      display: none;
      z-index: 99;
      overflow: hidden;
    }
    #sv-container { width: 100%; height: 100%; }
    #sv-close {
      position: absolute;
      top: 6px;
      right: 6px;
      background: #e74c3c;
      color: white;
      border: none;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      font-weight: 900;
      cursor: pointer;
      z-index: 100;
      padding: 0;
      margin: 0;
      text-transform: none;
    }
    #sv-label {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.6);
      color: white;
      font-size: 10px;
      padding: 6px;
      text-align: center;
      pointer-events: none;
      z-index: 99;
    }

    .grab-control {
      margin: 10px 10px 110px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .grab-btn {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      border: 1px solid #444;
      background: #2a2a2a;
      color: #fff;
      font-size: 20px;
      line-height: 1;
      box-shadow: 0 2px 10px rgba(0,0,0,0.35);
      cursor: pointer;
      padding: 0;
      margin: 0;
      text-transform: none;
    }

    .grab-btn.active {
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59,130,246,0.35);
    }

    #exitFocusBtn {
      position: absolute;
      left: 14px;
      bottom: 14px;
      width: 34px;
      height: 34px;
      padding: 0;
      margin: 0;
      border-radius: 12px;
      border: 1px solid #444;
      background: rgba(20, 20, 20, 0.75);
      color: #fff;
      font-size: 16px;
      line-height: 1;
      cursor: pointer;
      display: none;
      z-index: 9999;
      text-transform: none;
      box-sizing: border-box;
      min-width: 0;
    }
    #exitFocusBtn:hover {
      background: rgba(35, 35, 35, 0.9);
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20000;
      padding: 12px;
      box-sizing: border-box;
    }

    .overlay-card {
      width: min(560px, calc(100vw - 24px));
      max-height: calc(100vh - 24px);
      background: #1f1f1f;
      border: 1px solid #444;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .overlay-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px;
      border-bottom: 1px solid #333;
    }

    .overlay-title {
      font-size: 13px;
      font-weight: 900;
      color: #eee;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .overlay-close {
      width: 34px;
      height: 34px;
      padding: 0;
      margin: 0;
      border-radius: 10px;
      background: #2b2b2b;
      border: 1px solid #555;
      color: #fff;
      cursor: pointer;
      text-transform: none;
      flex: 0 0 auto;
      font-weight: 900;
    }
    .overlay-close:hover { background: #333; }

    .overlay-meta {
      padding: 10px 12px;
      border-bottom: 1px solid #333;
      font-size: 11px;
      color: #aaa;
    }

    .reviews-pager {
      padding: 10px 12px;
      border-bottom: 1px solid #333;
      display: none;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .reviews-pager button {
      width: auto;
      margin: 0;
      padding: 6px 8px;
      border-radius: 10px;
      background: #2b2b2b;
      border: 1px solid #444;
      color: #ddd;
      font-size: 11px;
      text-transform: none;
      font-weight: 900;
      cursor: pointer;
    }

    .reviews-pager button:hover { background: #333; }

    .reviews-pager button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .reviews-pager .pg-active {
      border-color: #3b82f6;
      background: rgba(59,130,246,0.18);
      color: #fff;
    }

    .reviews-pager .pg-ellipsis {
      font-size: 11px;
      color: #777;
      padding: 0 6px;
      user-select: none;
      font-weight: 900;
    }

    .reviews-pager .pg-label {
      margin-left: auto;
      font-size: 11px;
      color: #aaa;
      font-weight: 800;
      white-space: nowrap;
    }

    .overlay-body {
      padding: 12px;
      overflow: auto;
      min-height: 0;
      flex: 1;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
    }

    .review-item {
      display: flex;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid #2f2f2f;
    }

    .review-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      background: #333;
      flex: 0 0 auto;
    }

    .review-main {
      flex: 1;
      min-width: 0;
    }

    .review-headline {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .review-author {
      font-size: 12px;
      font-weight: 900;
      color: #eee;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .review-time {
      font-size: 10px;
      color: #777;
      white-space: nowrap;
      flex: 0 0 auto;
    }

    .review-rating {
      margin-top: 2px;
      font-size: 11px;
      color: #f1c40f;
      font-weight: 800;
    }

    .review-text {
      margin-top: 6px;
      font-size: 11px;
      color: #ddd;
      line-height: 1.4;
      white-space: normal;
      word-break: break-word;
    }

    .help-box {
      font-size: 11px;
      color: #ddd;
      line-height: 1.5;
    }
    .help-box ul {
      margin: 8px 0 0 18px;
      padding: 0;
    }
    .help-box li { margin: 6px 0; }

    @media (max-width: 768px) {
      body { flex-direction: column; }

      #sidebar {
        width: 100%;
        height: 60vh;
        order: 2;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
        padding: 10px;
        z-index: 20;
        gap: 5px;
      }

      #mapWrap {
        width: 100%;
        height: 40vh;
        order: 1;
      }

      h2 { display: none; }
      label { display: none; }
      input, select, button { padding: 8px; margin-bottom: 5px; font-size: 13px; }
      .btn-geo { margin-bottom: 5px; padding: 5px; }
      .tabs { margin-top: 0; }

      #panelArea {
        border-top: 0;
        padding-top: 0;
      }
    }
  </style>
</head>
<body>

  <div id="sidebar">
    <div class="topbar">
      <div style="display:flex; align-items:baseline; gap:8px;">
        <h2>AtlasGo</h2>
        <span style="font-size:12px; color:#888">v4.0 Student</span>
      </div>
      <button id="authBtn" class="auth-btn" type="button">Login</button>
    </div>

    <button class="btn-geo" onclick="locateUser()">üìç LocalizeazƒÉ-mƒÉ (GPS)</button>

    <label>CAUTA ORAS</label>
    <input id="city" type="text" placeholder="Ex: Voluntari...">

    <label>CATEGORIE</label>
    <select id="cat">
      <option value="convenience_store">Magazine / Minimarket</option>
      <option value="gas_station">Benzinarii</option>
      <option value="restaurant|cafe">Restaurante</option>
      <option value="tourist_attraction">Turism</option>
      <option value="spa|park">Relaxare</option>
      <option value="pharmacy">Farmacii</option>
      <option value="gym">Sala Fitness</option>
    </select>

    <div style="display:flex; gap:10px;">
      <div style="flex:1">
        <label>MOD TRANSPORT</label>
        <select id="travelMode" onchange="updateRouteMode()">
          <option value="DRIVING">üöó Ma»ôinƒÉ</option>
          <option value="TRANSIT" selected>üöå Autobuz/Metrou</option>
          <option value="WALKING">üö∂ Jos</option>
        </select>
      </div>
      <div style="flex:1">
        <label>RAZA: <span id="rVal">1500</span>m</label>
        <input id="rad" type="range" min="500" max="10000" value="1500" step="100" oninput="document.getElementById('rVal').innerText=this.value">
      </div>
    </div>

    <label>SORTARE</label>
    <select id="sort">
      <option value="dist">Distanta (Cel mai aproape)</option>
      <option value="rate">Rating (Cel mai bun)</option>
      <option value="best">Balansat (Best Match)</option>
    </select>

    <button class="btn-scan" onclick="runScan()">Scaneaza Zona</button>
    <button id="helpBtn" class="btn-help" type="button">‚ùî Cum func»õioneazƒÉ?</button>

    <div class="row-info">
      <span>Rezultate: <span id="count">0</span></span>
      <span style="color:#666">‚òÖ Favorite ‚Ä¢ üïò Istoric</span>
    </div>

    <div class="tabs">
      <button id="tabResults" class="tab-btn active" type="button">Rezultate</button>
      <button id="tabHistory" class="tab-btn" type="button">Istoric</button>
      <button id="tabFavs" class="tab-btn" type="button">Favorite</button>
    </div>

    <div id="panelArea">
      <div id="panelResults" class="panel active">

        <div id="paginationBar" style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
          <button id="prevPageBtn" type="button" style="width:auto; padding:6px 10px; border-radius:10px; background:#2b2b2b; border:1px solid #444; text-transform:none;">‚óÄ</button>
          <div id="pageLabel" style="flex:1; text-align:center; font-size:11px; color:#aaa; font-weight:800;">Pagina 1</div>
          <button id="nextPageBtn" type="button" style="width:auto; padding:6px 10px; border-radius:10px; background:#2b2b2b; border:1px solid #444; text-transform:none;">‚ñ∂</button>
        </div>

        <div id="resultsList"></div>
      </div>

      <div id="panelHistory" class="panel">
        <div id="historyList"></div>
      </div>

      <div id="panelFavs" class="panel">
        <div id="favList"></div>
      </div>
    </div>
  </div>

  <div id="mapWrap">
    <div id="map"></div>
    <button id="exitFocusBtn" type="button" aria-label="Ie»ôi din focus">‚úï</button>
    <div id="sv-panel">
      <button id="sv-close" type="button" aria-label="√énchide Street View" onclick="document.getElementById('sv-panel').style.display='none'">X</button>
      <div id="sv-container"></div>
      <div id="sv-label">Street View Interactiv</div>
    </div>
  </div>

  <div id="reviewsOverlay" class="overlay" aria-hidden="true">
    <div class="overlay-card" role="dialog" aria-modal="true" aria-labelledby="reviewsTitle">
      <div class="overlay-head">
        <div id="reviewsTitle" class="overlay-title">Recenzii</div>
        <button id="reviewsClose" class="overlay-close" type="button" aria-label="√énchide">‚úï</button>
      </div>
      <div id="reviewsMeta" class="overlay-meta">SelecteazƒÉ un rezultat pentru a vedea recenziile.</div>
      <div id="reviewsPager" class="reviews-pager"></div>
      <div id="reviewsBody" class="overlay-body"></div>
    </div>
  </div>

  <div id="helpOverlay" class="overlay" aria-hidden="true">
    <div class="overlay-card" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
      <div class="overlay-head">
        <div id="helpTitle" class="overlay-title">Ghid rapid</div>
        <button id="helpClose" class="overlay-close" type="button" aria-label="√énchide">‚úï</button>
      </div>
      <div class="overlay-body">
        <div class="help-box">
          <div style="color:#aaa; margin-bottom:10px;">
            ApasƒÉ pe un rezultat ca sƒÉ √Æl focusezi pe hartƒÉ »ôi sƒÉ vezi ruta. Pentru recenzii, folose»ôte butonul üí¨.
          </div>
          <ul>
            <li>Folose»ôte ‚ÄûLocalizeazƒÉ-mƒÉ‚Äù sau cautƒÉ un ora»ô.</li>
            <li>Alege categoria, raza »ôi modul de transport.</li>
            <li>ApasƒÉ ‚ÄûScaneazƒÉ Zona‚Äù pentru rezultate √Æn jurul cercului.</li>
            <li>√én listƒÉ: ‚òÖ adaugƒÉ la favorite, üí¨ deschide recenziile Google, üëÅ deschide Street View.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./assets/firebase.js"></script>
  <script src="./assets/app.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvbL5aBjXtO-_61bYgMKj2G9o3sEtztGY&libraries=places,geometry&callback=initMap" async defer></script>
</body>
</html>
